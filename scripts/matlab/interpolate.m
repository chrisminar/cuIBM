%testing the bilinear interpolation method
function f = interpolate(x, y, q)
a11 = 1;  a12 = x(1);  a13 = y(1); a14 = x(1)*y(1);
a21 = 1;  a22 = x(2);  a23 = y(2); a24 = x(2)*y(2);
a31 = 1;  a32 = x(3);  a33 = y(3); a34 = x(3)*y(3);
a41 = 1;  a42 = x(4);  a43 = y(4); a44 = x(4)*y(4);
A = [a11 a12 a13 a14;
     a21 a22 a23 a24;
     a31 a32 a33 a34;
     a41 a42 a43 a44];
detA = a11*a22*a33*a44 + a11*a23*a34*a42 + a11*a24*a32*a43...
      +a12*a21*a34*a43 + a12*a23*a31*a44 + a12*a24*a33*a41...
      +a13*a21*a32*a44 + a13*a22*a34*a41 + a13*a24*a31*a42...
      +a14*a21*a33*a42 + a14*a22*a31*a43 + a14*a23*a32*a41...
      -a11*a22*a34*a43 - a11*a23*a32*a44 - a11*a24*a33*a42...
      -a12*a21*a33*a44 - a12*a23*a34*a41 - a12*a24*a31*a43...
      -a13*a21*a34*a42 - a13*a22*a31*a44 - a13*a24*a32*a41...
      -a14*a21*a32*a43 - a14*a22*a33*a41 - a14*a23*a31*a42;

b11 = a22*a33*a44 + a23*a34*a42 + a24*a32*a43 - a22*a34*a43 - a23*a32*a44 - a24*a33*a42;
b12 = a12*a34*a43 + a13*a32*a44 + a14*a33*a42 - a12*a33*a44 - a13*a34*a42 - a14*a32*a43;
b13 = a12*a23*a44 + a13*a24*a42 + a14*a22*a43 - a12*a24*a43 - a13*a22*a44 - a14*a23*a42;
b14 = a12*a24*a33 + a13*a22*a34 + a14*a23*a32 - a12*a23*a34 - a13*a24*a32 - a14*a22*a33;
b21 = a21*a34*a43 + a23*a31*a44 + a24*a33*a41 - a21*a33*a44 - a23*a34*a41 - a24*a31*a43;
b22 = a11*a33*a44 + a13*a34*a41 + a14*a31*a43 - a11*a34*a43 - a13*a31*a44 - a14*a33*a41;
b23 = a11*a24*a43 + a13*a21*a44 + a14*a23*a41 - a11*a23*a44 - a13*a24*a41 - a14*a21*a43;
b24 = a11*a23*a34 + a13*a24*a31 + a14*a21*a33 - a11*a24*a33 - a13*a21*a34 - a14*a23*a31;
b31 = a21*a32*a44 + a22*a34*a41 + a24*a31*a42 - a21*a34*a42 - a22*a31*a44 - a24*a32*a41;
b32 = a11*a34*a42 + a12*a31*a44 + a14*a32*a41 - a11*a32*a44 - a12*a34*a41 - a14*a31*a42;
b33 = a11*a22*a44 + a12*a24*a41 + a14*a21*a42 - a11*a24*a42 - a12*a21*a44 - a14*a22*a41;
b34 = a11*a24*a32 + a12*a21*a34 + a14*a22*a31 - a11*a22*a34 - a12*a24*a31 - a14*a21*a32;
b41 = a21*a33*a42 + a22*a31*a43 + a23*a32*a41 - a21*a32*a43 - a22*a33*a41 - a23*a31*a42;
b42 = a11*a32*a43 + a12*a33*a41 + a13*a31*a42 - a11*a33*a42 - a12*a31*a43 - a13*a32*a41;
b43 = a11*a23*a42 + a12*a21*a43 + a13*a22*a41 - a11*a22*a43 - a12*a23*a41 - a13*a21*a42;
b44 = a11*a22*a33 + a12*a23*a31 + a13*a21*a32 - a11*a23*a32 - a12*a21*a33 - a13*a22*a31;

B = [b11 b12 b13 b14;
     b21 b22 b23 b24;
     b31 b32 b33 b34;
     b41 b42 b43 b44];
 
Ainv = B/detA;

a = Ainv*q';

f= @(X,Y) a(1) + a(2)*X + a(3)*Y + a(4)*X*Y;